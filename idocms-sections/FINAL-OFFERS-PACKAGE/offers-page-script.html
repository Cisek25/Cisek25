<!-- ============================================
     OFFERS PAGE - JAVASCRIPT
     Skrypt do obsługi filtrów i interakcji

     INSTRUKCJA:
     Wklej ten cały blok <script> na końcu strony offers
     (przed zamknięciem </body>)
     ============================================ -->

<script>
(function() {
  'use strict';

  // Czekaj na załadowanie DOM
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initOffersPage);
  } else {
    initOffersPage();
  }

  function initOffersPage() {

    // ===========================
    // 1. COLLAPSIBLE FILTERS
    // ===========================

    const filterHeaders = document.querySelectorAll('.filter_header');

    filterHeaders.forEach(function(header) {
      // Dodaj ikonę jeśli nie ma
      if (!header.querySelector('i')) {
        const icon = document.createElement('i');
        icon.className = 'fas fa-chevron-down';
        icon.style.transition = 'transform 0.3s ease';
        header.appendChild(icon);
      }

      // Znajdź content (następny element)
      const content = header.nextElementSibling;

      if (content) {
        // Dodaj klasę collapse
        if (!content.classList.contains('collapse')) {
          content.classList.add('collapse', 'show'); // Domyślnie otwarte
        }

        // Obsługa kliknięcia
        header.addEventListener('click', function(e) {
          e.preventDefault();
          const icon = this.querySelector('i');

          // Toggle
          content.classList.toggle('show');

          // Obróć strzałkę
          if (icon) {
            if (content.classList.contains('show')) {
              icon.style.transform = 'rotate(0deg)';
            } else {
              icon.style.transform = 'rotate(-90deg)';
            }
          }
        });
      }
    });

    // ===========================
    // 2. MOBILE FILTER TOGGLE
    // ===========================

    const showFiltersBtn = document.getElementById('show_filters');
    const menuFilter = document.getElementById('menu_filter');

    if (showFiltersBtn && menuFilter) {
      showFiltersBtn.addEventListener('click', function() {
        menuFilter.classList.toggle('active');

        if (menuFilter.classList.contains('active')) {
          this.textContent = 'Ukryj Filtry';
        } else {
          this.textContent = 'Pokaż Filtry';
        }
      });
    }

    // ===========================
    // 3. COUNT SELECTED FILTERS
    // ===========================

    const filterCheckboxes = document.querySelectorAll('.checkbox input[type="checkbox"]');

    filterCheckboxes.forEach(function(checkbox) {
      checkbox.addEventListener('change', updateFilterCount);
    });

    function updateFilterCount() {
      const checked = document.querySelectorAll('.checkbox input[type="checkbox"]:checked').length;
      const filterBtn = document.querySelector('#filter_buttons button');

      if (filterBtn) {
        const baseText = filterBtn.getAttribute('data-text') || 'Zastosuj Filtry';
        if (checked > 0) {
          filterBtn.textContent = baseText + ' (' + checked + ')';
        } else {
          filterBtn.textContent = baseText;
        }
      }
    }

    // Zapisz oryginalny tekst
    const filterBtn = document.querySelector('#filter_buttons button');
    if (filterBtn && !filterBtn.getAttribute('data-text')) {
      filterBtn.setAttribute('data-text', filterBtn.textContent);
    }

    updateFilterCount();

    // ===========================
    // 4. SMOOTH SCROLL
    // ===========================

    const smoothLinks = document.querySelectorAll('a[href^="#"]:not([href="#"]):not([href="#!"])');

    smoothLinks.forEach(function(link) {
      link.addEventListener('click', function(e) {
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          e.preventDefault();
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // ===========================
    // 5. ANIMATION ON SCROLL
    // ===========================

    if ('IntersectionObserver' in window) {
      const observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
          }
        });
      }, {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      });

      const cards = document.querySelectorAll('.offers-container');
      cards.forEach(function(card) {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(card);
      });
    }

    console.log('✓ Offers page initialized');
  }

})();
</script>
